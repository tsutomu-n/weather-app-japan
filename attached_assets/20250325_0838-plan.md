ã‚ˆã‚Šãƒ­ãƒã‚¹ãƒˆã«ã™ã‚‹ãŸã‚ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚ä»¥ä¸‹ã®ç‚¹ã«ç„¦ç‚¹ã‚’å½“ã¦ã¦æ”¹å–„ã—ã¾ã™ã€‚

å‹å®‰å…¨æ€§ã®å¼·åŒ–: TypeScript ã®å‹ã‚’ã‚ˆã‚Šå³å¯†ã«å®šç¾©ã—ã€ã‚¨ãƒ©ãƒ¼ã‚’æ—©æœŸã«æ¤œå‡ºã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–: API å‘¼ã³å‡ºã—æ™‚ã®ã‚¨ãƒ©ãƒ¼ã ã‘ã§ãªãã€Gemini ã‹ã‚‰ã®å¿œç­”ãŒæœŸå¾…ã™ã‚‹å½¢å¼ã§ãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼ã‚‚å‡¦ç†ã—ã¾ã™ã€‚

å®šæ•°ã®æŠ½å‡º: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚„ãƒ¢ãƒ‡ãƒ«åãªã©ã®å®šæ•°ã‚’åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«æŠ½å‡ºã—ã€ã‚³ãƒ¼ãƒ‰ã®è¦‹é€šã—ã‚’è‰¯ãã—ã¾ã™ã€‚

é–¢æ•°ã®åˆ†å‰²: getWeatherData é–¢æ•°ã‚’ã€API å‘¼ã³å‡ºã—éƒ¨åˆ†ã¨ UI æ›´æ–°éƒ¨åˆ†ã«åˆ†å‰²ã—ã€è²¬å‹™ã‚’åˆ†é›¢ã—ã¾ã™ã€‚

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ†å‰²: å¤©æ°—æƒ…å ±ã®è¡¨ç¤ºéƒ¨åˆ†ã‚’åˆ¥ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«åˆ†å‰²ã—ã¾ã™ã€‚

1. å®šæ•°ã®å®šç¾© (constants.ts):

// app/constants.ts
export const MODEL_NAME = "gemini-1.5-flash";
export const PROMPT_TEMPLATE = `
  ã‚ãªãŸã¯ã€æœ­å¹Œã®å¤©æ°—æƒ…å ±ã‚’æä¾›ã™ã‚‹ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
  ä»Šæ—¥ã®æœ­å¹Œå¸‚ï¼ˆä¸»ã«ä¸­å¤®åŒºï¼‰ã®å¤©æ°—ã€æ°—æ¸©ã€æ°—åœ§ã€èŠ±ç²‰ã€é»„ç ‚ã€PM2.5ã®æƒ…å ±ã‚’ã€ä»¥ä¸‹ã®å½¢å¼ã§æä¾›ã—ã¦ãã ã•ã„ã€‚
  ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ã€ã€Œä¸æ˜ã€ã¨è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚

  # ğŸŒ¸ğŸŒ¼ ä»Šæ—¥ã®æœ­å¹ŒãŠå¤©æ°—æƒ…å ± ğŸŒ¼ğŸŒ¸

  **â˜ï¸â˜”ï¸ å¤©æ°—:** [å¤©æ°—]
  **ğŸŒ¡ï¸ æ°—æ¸©:** æœ€é«˜ [æœ€é«˜æ°—æ¸©]â„ƒ / æœ€ä½ [æœ€ä½æ°—æ¸©]â„ƒ
  **ğŸƒ é¢¨:** [é¢¨é€Ÿ] m/s
  **ğŸ’§ æ¹¿åº¦:** [æ¹¿åº¦] %
  **â¬‡ï¸ æ°—åœ§:** [æ°—åœ§] hPa (å‚¾å‘: [ä¸Šæ˜‡/ä½ä¸‹/å®‰å®š])

  **ğŸŒ² èŠ±ç²‰:**
  *   ã‚¹ã‚®èŠ±ç²‰: [é£›æ•£çŠ¶æ³]
  *   ãã®ä»–: [ãã®ä»–ã®èŠ±ç²‰æƒ…å ±]

  **ğŸ’› é»„ç ‚:** [é»„ç ‚æƒ…å ±]

  **ğŸŒ« PM2.5:** [PM2.5æƒ…å ±]

  **ğŸ“ ä¸€è¨€:**
  [å…¨ä½“çš„ãªã‚³ãƒ¡ãƒ³ãƒˆ]
`;


2. API Route (app/api/generate/route.ts):

// app/api/generate/route.ts
import { GoogleGenerativeAI, GenerativeModel, Part } from "@google/generative-ai";
import { NextRequest, NextResponse } from 'next/server';
import { MODEL_NAME } from '../../constants';

const genAI = new GoogleGenerativeAI(process.env.GOOGLE_API_KEY || "");
let model: GenerativeModel;

function getModel() {
  if (!model) {
      model = genAI.getGenerativeModel({ model: MODEL_NAME });
  }
  return model;
}

export async function POST(req: NextRequest) {
  try {
    const { prompt } = await req.json();

    const model = getModel();

    const result = await model.generateContent(prompt);
    const response = await result.response;
    const text = response.text();


    return NextResponse.json({ text });

  } catch (error) {
    console.error("Error generating content:", error);
    // ã‚ˆã‚Šè©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’è¿”ã™
    return NextResponse.json(
      { error: "Failed to generate content", details: (error as Error).message },
      { status: 500 }
    );
  }
}
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
TypeScript
IGNORE_WHEN_COPYING_END

3. WeatherInfo ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (app/components/WeatherInfo.tsx):

// app/components/WeatherInfo.tsx
import React from 'react';
import ReactMarkdown from 'react-markdown';

interface WeatherInfoProps {
  weatherData: string;
}

const WeatherInfo: React.FC<WeatherInfoProps> = ({ weatherData }) => {
  return (
    <ReactMarkdown>{weatherData}</ReactMarkdown>
  );
};

export default WeatherInfo;
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
TypeScript
IGNORE_WHEN_COPYING_END

4. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ (app/page.tsx):

// app/page.tsx
'use client';
import { useState } from 'react';
import WeatherInfo from './components/WeatherInfo';
import { PROMPT_TEMPLATE } from './constants';

interface GenerateResponse {
  text?: string;
  error?: string;
  details?: string;
}

export default function Home() {
  const [showWeather, setShowWeather] = useState(false);
  const [weatherData, setWeatherData] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null); // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã® state

  // APIå‘¼ã³å‡ºã—ã‚’è¡Œã†é–¢æ•°
  const fetchWeatherData = async () => {
    try {
      const response = await fetch('/api/generate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ prompt: PROMPT_TEMPLATE }),
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data: GenerateResponse = await response.json();

      if (data.error) {
        throw new Error(data.error + (data.details ? `: ${data.details}` : ""));
      }

      if (!data.text) {
          throw new Error("No text received from API");
      }
      return data.text;

    } catch (error:any) {
        console.error('Error fetching weather data:', error);
      throw new Error(error.message || 'Unknown error occurred'); // ã‚¨ãƒ©ãƒ¼ã‚’ä¼æ’­
    }
  };

  // å¤©æ°—æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®é–¢æ•° (APIå‘¼ã³å‡ºã—ã¨UIæ›´æ–°ã‚’åˆ†é›¢)
  const getWeatherData = async () => {
    setLoading(true);
    setShowWeather(true);
    setWeatherData('');
    setError(null); // ã‚¨ãƒ©ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ

    try {
      const text = await fetchWeatherData();
      setWeatherData(text);
    } catch (error: any) {
      setError(error.message || 'Unknown error occurred'); // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚»ãƒƒãƒˆ
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{ textAlign: 'center', padding: '20px' }}>
      <button
        style={{ padding: '10px 20px', fontSize: '1.2em' }}
        onClick={getWeatherData}
      >
        ä»Šæ—¥ã®æœ­å¹Œ
      </button>

      {showWeather && (
        <div style={{ marginTop: '20px' }}>
          {loading ? (
            <div>ç”Ÿæˆä¸­...</div>
          ) : error ? (
            <div style={{ color: 'red' }}>ã‚¨ãƒ©ãƒ¼: {error}</div>
          ) : (
            <WeatherInfo weatherData={weatherData} />
          )}
        </div>
      )}
    </div>
  );
}
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
TypeScript
IGNORE_WHEN_COPYING_END

å¤‰æ›´ç‚¹ã®è©³ç´°:

å‹å®šç¾©:

GenerateResponse ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã€API ã‹ã‚‰ã®å¿œç­”ã®å‹ã‚’æ˜ç¢ºã«ã—ã¾ã—ãŸã€‚

WeatherInfoProps ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’å®šç¾©ã€‚

ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:

API Route (route.ts) ã§ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

fetchWeatherData é–¢æ•°ã§ã€API ã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ (ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ã€data.errorã€data.text ãŒãªã„å ´åˆ) ã‚’é©åˆ‡ã«å‡¦ç†ã—ã€ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

getWeatherData é–¢æ•°ã§ã€ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒã—ã€error ã‚¹ãƒ†ãƒ¼ãƒˆã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

å®šæ•°ã®æŠ½å‡º:

MODEL_NAME ã¨ PROMPT_TEMPLATE ã‚’ constants.ts ã«æŠ½å‡ºã—ã¾ã—ãŸã€‚

é–¢æ•°ã®åˆ†å‰²:

fetchWeatherData é–¢æ•°ã‚’å°å…¥ã—ã€API å‘¼ã³å‡ºã—ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ getWeatherData é–¢æ•°ã‹ã‚‰åˆ†é›¢ã—ã¾ã—ãŸã€‚

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²:
ã€€ã€€*ã€€WeatherInfoã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã€å¤©æ°—æƒ…å ±ã®ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’page.tsxã‹ã‚‰åˆ†é›¢ã—ã¾ã—ãŸã€‚

ã“ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã€ä¿å®ˆæ€§ã€å …ç‰¢æ€§ãŒå‘ä¸Šã—ã¾ã—ãŸã€‚ç‰¹ã«ã€å‹å®šç¾©ã®å¼·åŒ–ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ã«ã‚ˆã‚Šã€æ½œåœ¨çš„ãªå•é¡Œã‚’æ—©æœŸã«ç™ºè¦‹ã—ã€ã‚ˆã‚Šå®‰å®šã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚